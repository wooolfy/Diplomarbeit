\chapter{Systemspezifikation}
% 		\section{Dingschema/Handlungsschema?}
% 		\begin{itemize}
%           \item Kompletten Funktionsumfang ermitteln und dokumentieren
%           \item einzelne Handlungen müssen vollständig ausformuliert werden
%           \item Evtl. dann schon eine Vorauswahl treffen, wenn Funktionsumfang
%           zu groß für den Rahmen dieser Arbeit sein sollte und auf Grundlage
%           dessen weiterarbeiten. (Kernfunktionen umsetzen oder evtl. nur
%           Prototypen erzeugen, der nur teilweise funktionsfähig sein wird)
%         \end{itemize}
      	%\section{Model Driven Architecture}
      	
      	Das folgende Kapitel beschäftigt sich mit der Systemspezifikation für
      	die zu entwicklende Smartphone App. Dabei wird ein Konzept erstellt,
      	dass als Grundlage für den modellgetriebenen Ansatz dienen soll. 
      	
      	Da wir uns jetzt bei der konkreten Umsetzung der Software befinden ist
      	es an der Zeit dem Projekt einen Namen zu geben. %Formulierung
      	
      	\begin{quote}
        	\texttt{YASA - Yet Another Smartphone Applicaction}  
        \end{quote}

		Nachfolgend im Text wird mit \texttt{YASA} bezug auf den Prototypen genommen.
		%Formulierung
		
		Ausserdem werden die verschiedenen Tools ausgewählt, die zur Modellierung von
		\texttt{YASA} dienen sollen. Dabei wird spezzielles Augenmerkt darauf gelegt,
		dass die grafischen Werkzeuge saubere XML Dateien generieren, die später für
		die (eventuell Model-zu-Model und)Model-zu-Code Transformation benutzt
		werden. Beispielhaft wird versucht aus den verschiedenen Diagrammarten
		(Klassendiagramm, Aktivitätendiagramm) Textbausteine zu generieren, um zu
		überprüfen, welche Programme überhaupt zur Generierung von Transformationen
		geeignet sind und welche nicht alle Diagrammtypischen Merkmale beherrschen.
		Eventuell wird versucht bestehende Programme zu erweitern im Hinblick auf die
		volle Unterstützung der verwendeten Diagrammtypen.
      	

		\section{Geschäftsvorfall für die umzusetzende App}    
        Ein realistischer Geschäftanwendungsfall (kurz GAF) soll als Grundlage
        für die Umsetzung von \texttt{YASA} dienen. 
        
        \subsection{Vorgaben}
        
        Es soll gezeigt werden, dass mit MDA die Umsetzung des 
        GAF technisch möglich ist. Ebenso sollen die Grenzen
        der Technologie erforscht werden. Dabei soll gezeigt werden, dass
        folgende Artefakte aus dem Modell generiert werden können: 
        \begin{itemize}
          \item Persistenz
          \item Fachliche Logik
          %\item Arbeitsabläufe (Workflow)
          \item Benutzer Frontend
        \end{itemize}
        
        \subsection{Beschreibung des Geschäftsvorfalls}
        
        Dafür wurde eine spezielle Funktion aus Kapitel
        2 ausgewählt, die nun umgesetzt wird:
        
        \begin{quote}
        ``Spare Parts Catalogue: In einem über Smartphone
        aufrufbaren Ersatzteilkatalog soll es möglich sein, Teile der verwendeten
        Maschine nachzubestellen. Bei einem Fehler wird von der Maschine
        überprüft, ob ein Maschinenteil defekt ist. Falls dies zutrifft,
        wird dem Benutzer vorgeschlagen, dieses nachzubestellen.''
        \end{quote}

%TODO: überarbeiten!!!!

      	\section{Anwendung auf die Anforderungsdefinition}
      	
      	Nach der Kurzbeschreibung des Anwendungsfalls folgt als nächstes die
      	Dokumentierung der Einzelheiten. Zuerst folgt eine textuelle
      	Beschreibung, die als Grundlage zur Erstellung des CIM dient. 
      	
      	Der Prototyp ``Spare Parts Catalogue'' soll folgende Funktionen
      	unterstützen:
      	
      	\begin{itemize}
            \item Ersatzteilkatalog durchsuchen
            \item Ersatzteil bestellen
            \item Bestellung stornieren
            \item Bestellstatus abfragen
            \item Maschinenfehler melden
          \end{itemize}
      	
      	Anhand dieser Beschreibung kann ein Use-Case-Diagramm erstellt werden
      	mit den unterstützten Funktionen seitens des Nutzers und des Systems
      	(Abbildung \ref{fig:usecase}).
      	
      	\begin{figure}[h]%{r}{8cm}
		      \centering	% zentrieren
		      \includegraphics[width=1\textwidth]{Ersatzteilkatalog_use_case}
		      \caption{Geschäftsanwendungsfall Use-Case-Diagramm}
		      \label{fig:usecase}
		\end{figure}

      	\subsection{Erstellen eines Computation Independent Models}

		Die Funktionen von YASA lassen sich im Detail wie folgt beschreiben:
		%\begin{minipage}[!t]{0.4\textwidth}
		%\begin{table}[b]
	        	%\centering \leavevmode %Tabelle zentrieren
		        %\caption{}
		        %\label{tab:cross-platform}
		        %\addtocounter{footnote}{+1}
		        \newcolumntype{A}{%
				>{\columncolor{hellgrau}}p}
				\newcolumntype{B}{%
				>{\columncolor{hellgrau}}p}
				%\color{black}
				\arrayrulecolor{white}
				%TODO: \arrayrulewidth{3pt} irgendwie klappt das nicht... !
		        \begin{longtable}{||A{5cm}||B{10cm}||}
                %\centering \leavevmode
                %\hhline{|t:==:t|}
                \hline \hline
                \rowcolor{dunkelgrau}
                Funktion	 		&	Ersatzteilkatalog durchsuchen\\
                \hline \hline
                Kurzbeschreibung 	&	Ein Kunde möchte den Ersatzteilkatalog
                						durchblättern bzw. durchsuchen\\
                \hline \hline
                Akteur 				&	Benutzer\\
                \hline \hline
                Vorbedingungen		&	Kundendaten bekannt\\
                \hline \hline
				Teilhandlungen		&	Suchbegriff eingeben\\
                                    &   Ersatzteile blättern\\
                                    &   Ersatzteil auswählen (Detail
                                             ansehen)\\
                \hline \hline
				Nachbedingungen bei Erfolg		&	Ersatzteil ausgewählt\\
				%\hhline{|t:==:t|}
				\hline \hline
				Nachbedingungen bei Misserfolg	&	Kein Ersatzteil gefunden\\
												&	Fehlermeldung ausgeben\\
				%\hhline{|t:==:t|}
				\hline \hline
				%\end{tabular}
				
				%\newline

		        %\begin{tabular}{||A{5cm}||B{10cm}||}
                \hline \hline
                \rowcolor{dunkelgrau}
                Funktion	 		&	Ersatzteil bestellen\\
                \hline \hline
                Kurzbeschreibung 	&	Ein Kunde möchte ein Ersatzteil bestellen,
                						dessen Bezeichnung und Funktion ihm bereits 
                						bekannt ist\\ 
                \hline \hline 
                Akteur 				&	Benutzer\\
                \hline \hline
                Vorbedingungen		&	Ersatzteilkatalog
                						durchsuchen/ Maschinenfehler melden\\ 
                \hline \hline
				Teilhandlungen		&	Bestellvorgang einleiten\\
									&	Bestelldetails anzeigen\\
                                    &   Bestellung abschicken\\
                \hline \hline
				Nachbedingungen	bei Erfolg		&	Bestellung wurde erfolgreich übermittelt\\
				\hline \hline
				Nachbedingungen	bei Missrfolg	&	Bestellung konnte nicht übermittelt werden\\
				\hline \hline
				%\end{tabular}

		        %\begin{tabular}{||A{5cm}||B{10cm}||}
                \hline \hline
                \rowcolor{dunkelgrau}
                Funktion	 		&	Bestellung stornieren\\
                \hline \hline
                Kurzbeschreibung 	&	Ein Kunde möchte eine bereits ausgeführte
                						Bestellung stornieren\\ 
                \hline \hline 
                Akteur 				&	Benutzer\\ 
                \hline \hline
                Vorbedingungen		&	Ersatzteil wurde bestellt\\ 
                \hline \hline
				Teilhandlungen		&	Bestelldetails anzeigen\\
                                    &   Bestellung stornieren\\
                \hline \hline
				Nachbedingungen bei Erfolg		&	Bestellung wurde erfolgreich storniert\\
				\hline \hline
				Nachbedingungen bei Misserfolg	&	Bestellung konnte nicht storniert werden
													(evtl. wurde Bestellung schon versandt) \\
				\hline \hline
				%\end{tabular}

		        %\begin{tabular}{||A{5cm}||B{10cm}||}
                \hline \hline
                \rowcolor{dunkelgrau}
                Funktion	 		&	Bestellstatus abfragen\\
                \hline \hline
                Kurzbeschreibung 	&	Ein Kunde möchte den Status seiner
                Bestellung abfragen 
                						(in Bearbeitung, versandt, nicht lieferbar, etc.)\\ 
                \hline \hline 
                Akteur 				&	Benutzer\\
                \hline \hline
                Vorbedingungen		&	Ersatzteil wurde bestellt\\ 
                \hline \hline
				Teilhandlungen		&	Bestelldetails anzeigen\\
									&	Bestellstatus anzeigen\\
                \hline \hline
				Nachbedingungen bei Erfolg			&	Bestellung gefunden\\
				\hline \hline
				Nachbedingungen bei Misserfolg		&	Keine Bestellung gefunden\\
													&	Fehlermeldung ausgeben\\
				\hline \hline
				%\end{tabular}

		        %\begin{tabular}{||A{5cm}||B{10cm}||}
                \hline \hline
                \rowcolor{dunkelgrau}
                Funktion	 		&	Maschinenfehler melden\\
                \hline \hline
                Kurzbeschreibung 	&	Die Fertigungsmaschine hat einen Fehler
                festgestellt 
                					 	und kann nicht fortfahren. Eine Systemanalyse
                stellt fest, 
                						dass ein Teil der Maschine kaputt ist und sendet
                dem Benutzer eine Fehlermeldung \\ 
                \hline \hline 
                Akteur 				&   System\\ 
                \hline \hline
                Vorbedingungen 		&	Fehler im System\\
                				 	&	Fehler kann ermittelt werden\\
                \hline \hline
				Teilhandlungen		&	Systemmeldung mit Fehler erstellen\\
									&	passendes Ersatzteil ermitteln\\
									&	Systemmeldung an Benutzer senden\\
                \hline \hline
				Nachbedingungen	bei Erfolg		&	Nutzer wurde über Systemfehler informiert und
				kann Ersatzteil bestellen\\ 
				\hline \hline
				Nachbedingungen	bei Misserfolg	&	Meldung konnte nicht übermittelt werden\\
				\hline \hline
				\end{longtable}
		%\end{table}
		%\end{minipage}

		Als nächstes werden nun diese textuellen Beschreibungen möglichst genau in
		Diagramme umgewandelt. Zur Erfassung dieser auf grober Detailstufe wird als
		Darstellung das Aktivitätsdiagramm verwendet.
		
		\begin{figure}[h]
		      \centering	% zentrieren
		      \includegraphics[width=1\textwidth]{activity_durchsuchen}
		      \caption{Aktivitätsdiagramm Ersatzteilkatalog durchsuchen}
		      \label{fig:activity_durchsuchen}
		\end{figure}		

      	\subsection{PIM}
      	
      	Um die dargestellten Funktionen weiter umzusetzen und ein Platform
      	Independent Model zu generieren wird nun die Plattformunabhängige
      	Basisarchitektur festgelegt.
      	
      	Diese lässt sich wie folgt darstellen:
      	
      	\begin{table}[h]
        	\centering \leavevmode %Tabelle zentrieren
        	\caption{Architektur von YASA-Anwendungen}
		    \label{tab:yasa-architecture}
% 	        \newcolumntype{A}{%
% 			>{\columncolor{hellgrau}}c}
 			\arrayrulecolor{black}
	      	\begin{tabular}{||c||}	          
	          \hline \hline  
	          	Präsentation / View \\
	          \hline  \hline
	          	Dialogfluss \\
	          \hline  \hline
	          	Geschäftslogik/Services \\
	          \hline  \hline
	          	Persistenz \\
	          \hline  \hline   	  
	        \end{tabular}
		\end{table}

		Als oberste Schicht im Diagramm \ref{tab:yasa-architecture} finden wir die
		Präsentationsschicht. Diese ist zuständig für die Darstellung des Inhalts auf
		dem jeweiligen Smartphone in einer für den Benutzer verständliche Art und
		Weise. 
		
		Darunter befindet sich der Dialogfluss. Hier werden Kontrollflüsse der
		Anwendung definiert. 
		
% 		Es folgt die Geschäftslogik des Systems, die in Form von
% 		Services zur Verfügung gestellt werden. 
		
		Sollen Daten im Rahmen der Geschäftslogik dauerhaft gespeichert und abrufbar
		sein, kümmert sich die Persistenzschicht darum. 
		
		Die festgelegten Schichten können durch folgende UML-Profile modelliert
		werden:

		\begin{itemize}
          \item Präsentation (View): Metamodell zur Modellierung der auf dem
          Smartphone darzustellenden Oberfläche in Form von Dialogmasken.
          Interaktionsmöglichkeiten des Nutzers mit der Oberfläche und den
          enthaltenen Schaltflächen wird hier festgelegt.
          \item Dialogfluss (Pageflow Profile): Profil zur Modellierung von
          verzweigten Dialogflüssen
          \item Persistenz (Persistence Profile): Modellierung des persistenten
          Charakters von Entitätsklassen
        \end{itemize}
        
        
        \subsubsection{Modellierung PIM}
        
        \begin{figure}[h]
		      \centering	% zentrieren
		      \includegraphics[width=1\textwidth]{profile_pageflow}
		      \caption{Definition von Pageflow Profile}
		      \label{fig:profile_pageflow}
		\end{figure}	

		\begin{figure}[h]
		      \centering	% zentrieren
		      \includegraphics[width=1\textwidth]{profile_view}
		      \caption{Definition des Metamodells View}
		      \label{fig:profile_view}
		\end{figure}	
        
        Als Basisdiagramm soll uns das Aktivitätsdiagramm dienen, welches durch
        weitere Elemente erweitert wurde. Zum einen wäre dies das Metamodell
        View, das die Konstrukte zur Modellierung der Dialogmasken enthält
        (siehe Abbildung \ref{fig:profile_pageflow}).
        
        %TODO: zum anderen
        
        Als nächstes zu definieren ist das View Metamodell. Hier wird festgelegt,
        welche Elemente zur Dartellung verwendet werden und wie der Benutzer die
        dargestellten Elemente manipulieren darf (Abbildung
        \ref{fig:profile_view}). Basisbaustein ist der \texttt{View}. Ihm werden
        beliebig viele View-Elemente zugeordnet. Weiterhin im Modell enthalten
        sind \texttt{OutputElemente} für die übergebenden Modelldaten in
        grafischer Form und den \texttt{InputElementen}, die Werte des
        Pageflow-Kontextes durch Benutzereingaben aktualisieren. Daneben gibt es
        \texttt{CommandElemente}, an die ein \texttt{Outcome} gehängt werden
        kann(Kontrollflusssteuerung). Die Mitgeschickten Nutzdaten werden durch
        ein Element des Typs \texttt{ContextContainer} angehangen.
        
        
        Nach der Definition der verschiedenen Modelle lassen sich diese auf
        unsere Spezifikation anwenden. Im konkreten Fall ``Ersatzteilkatalog
        durchsuchen'' können wir den in Abbildung
        \ref{fig:ad_Ersatzteilkatalog_durchsuchen} dargestellten Dialogfluss
        generieren.
        
        \begin{figure}[h]
		      \centering	% zentrieren
		      \includegraphics[width=1\textwidth]{ad_Ersatzteilkatalog_durchsuchen}
		      \caption{Dialogfluss ``Ersatzteilkatalog durchsuchen''}
		      \label{fig:ad_Ersatzteilkatalog_durchsuchen}
		\end{figure}	

		TODO: Erklärung Fluss
		
		%TODO: Skizze im Anhang einfügen?
		Zur Beschreibung des Dialogflusses gehören ausserdem weitere Details, um die
		gestellten Anforderungen vollständig abzubilden. (evtl. Verweis
		Entwurfskizze). So muss jeder von einem \texttt{ViewCall} aufgerufene
		\texttt{View} weiter detailliert und mit dem entsprechenden Datenmodell
		verbunden werden (Abbildung \ref{fig:view_Ersatzteilkatalog_durchsuchen}).
        
        
        \begin{figure}[h]
		      \centering	% zentrieren
		      \includegraphics[width=1\textwidth]{view_Ersatzteilkatalog_durchsuchen}
		      \caption{Anwendung des View-Metamodells}
		      \label{fig:view_Ersatzteilkatalog_durchsuchen}
		\end{figure}	
      %TODO: Klassendiagramm erstellen für Persistenz. Aber was/wie?    
      
      
      
      
     
      
     
      
      